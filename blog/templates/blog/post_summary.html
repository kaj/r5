{% load blogtags comments i18n %}
<article lang="{{post.lang}}">
  {% get_comment_count for post as comment_count %}
  <header>
    <h1><a href="{{post.get_absolute_url}}">{{post.title|safe}}</a></h1>
    {% publine post %}
  </header>
  
  {% if post.abstract %}
    {% if post.frontimage %}
      <aside>{{post.frontimage_output}}</aside>
    {% endif %}
    <div class="abstract">{{post.abstract_output}}</div>
  {% endif %}

  {% if update.note %}
    <div class="update">
      <strong>{% trans "Uppdatering" %}
        <time datetime="{{update.time|date:'c'}}">{{update.time}}</time>:</strong>
      {{update.note_output}}
    </div>
  {% endif %}

  {% if post.abstract %}
    <p class="readmore">
      <a href="{{post.get_absolute_url}}">
        {% if comment_count %}
          {% blocktrans with title=post.title|safe count comments=comment_count %}
            Läs inlägget {{title}} och en kommentar
          {% plural %}
            Läs inlägget {{title}} och {{comments}} kommentarer
          {% endblocktrans %}
        {% else %}
          {% blocktrans with post.title|safe as title %}
            Läs och kommentera inlägget {{title}}
          {% endblocktrans %}
        {% endif %}
      </a>
    </p>

  {% else %}
    <div>
      {{post.content_output}}
    </div>

    <p class="readmore">
      <a href="{{post.get_absolute_url}}#comments">
        {% if comment_count %}
          {% blocktrans count comments=comment_count %}
            Läs en kommentar
          {% plural %}
            Läs {{comments}} kommentarer
          {% endblocktrans %}
        {% else %}
          {% trans "Kommentera inlägget" %}
        {% endif %}
      </a>
    </p>
  {% endif %}
</article>
